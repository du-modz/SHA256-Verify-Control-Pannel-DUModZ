<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DUModZ Premium Control Panel</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        :root {
            --bg: #f0f4f9;
            --card-bg: #f0f4f9;
            --text-main: #1e293b;
            --accent: #3b82f6;
            --shadow-light: #ffffff;
            --shadow-dark: #d1d9e6;
            --glass-border: rgba(255, 255, 255, 0.7);
        }

        .dark-mode {
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --accent: #60a5fa;
            --shadow-light: #2d3748;
            --shadow-dark: #020617;
            --glass-border: rgba(255, 255, 255, 0.05);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-x: hidden;
        }

        /* Neumorphic & Glassmorphic Mix */
        .neu-card {
            background: var(--card-bg);
            border-radius: 32px;
            box-shadow: 12px 12px 24px var(--shadow-dark), -12px -12px 24px var(--shadow-light);
            border: 1px solid var(--glass-border);
            transition: transform 0.3s ease;
        }

        .neu-inset {
            background: var(--card-bg);
            box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
            border-radius: 18px;
            border: none;
        }

        .neu-btn {
            background: var(--card-bg);
            box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
            transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 20px;
        }

        .neu-btn:active {
            box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
            transform: scale(0.96);
        }

        .gradient-icon {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .stagger-card {
            opacity: 0;
            animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        /* Custom Dropdown Styling */
        datalist {
            background-color: var(--card-bg);
        }

        /* Responsive Fixes */
        @media (max-width: 768px) {
            .main-container { padding: 16px; max-width: 100%; }
            .header-title { font-size: 1.5rem; }
        }
    </style>
</head>
<body class="min-h-screen pb-32">

    <!-- LOGIN UI -->
    <div id="login-page" class="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-[var(--bg)]">
        <div class="neu-card p-10 w-full max-w-md text-center stagger-card">
            <div class="w-20 h-20 bg-blue-600 rounded-[28px] mx-auto mb-6 flex items-center justify-center text-white text-3xl shadow-xl shadow-blue-500/30">
                <i class="fas fa-fingerprint"></i>
            </div>
            <h2 class="text-3xl font-extrabold mb-2 tracking-tight">Admin Entry</h2>
            <p class="text-sm opacity-50 mb-8">Secure access to DUModZ Database</p>
            
            <div class="space-y-5">
                <div class="text-left">
                    <label class="text-[10px] uppercase font-bold ml-4 opacity-40 mb-1 block">Email Address</label>
                    <input list="emails" id="email" class="neu-inset w-full p-4 outline-none" placeholder="Select or type email">
                    <datalist id="emails">
                        <option value="dumodz.info@gmail.com">
                    </datalist>
                </div>
                <div class="text-left">
                    <label class="text-[10px] uppercase font-bold ml-4 opacity-40 mb-1 block">Secret Password</label>
                    <input type="password" id="password" class="neu-inset w-full p-4 outline-none" placeholder="••••••••">
                </div>
                <button onclick="login()" class="neu-btn w-full py-4 mt-4 font-bold text-blue-600 text-lg flex items-center justify-center gap-2">
                    <i class="fas fa-shield-check"></i> Unlock Dashboard
                </button>
            </div>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div id="dashboard" class="hidden">
        <!-- Modern Header -->
        <header class="sticky top-0 z-50 px-6 py-5 flex justify-between items-center bg-[var(--bg)]/80 backdrop-blur-xl">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 neu-card flex items-center justify-center">
                    <img src="https://cdn-icons-png.flaticon.com/512/889/889102.png" class="w-8 h-8 rounded-lg" alt="logo">
                </div>
                <div>
                    <span class="text-[10px] font-bold opacity-40 uppercase tracking-tighter">System Online</span>
                    <h1 id="admin-label-text" class="text-xl font-extrabold header-title">DUModZ</h1>
                </div>
            </div>
            <div class="flex gap-4">
                <button onclick="toggleTheme()" class="neu-btn w-12 h-12 flex items-center justify-center text-lg">
                    <i id="theme-icon" class="fas fa-moon"></i>
                </button>
                <button onclick="logout()" class="neu-btn w-12 h-12 flex items-center justify-center text-red-500 text-lg">
                    <i class="fas fa-power-off"></i>
                </button>
            </div>
        </header>

        <main class="main-container mx-auto px-6 max-w-[768px] mt-4">
            <!-- Global Config Section -->
            <section class="neu-card p-8 mb-10 stagger-card" style="animation-delay: 0.1s">
                <div class="flex items-center gap-3 mb-8">
                    <i class="fas fa-sliders-h gradient-icon text-2xl"></i>
                    <h2 class="text-xl font-bold">Global Configuration</h2>
                </div>
                <div class="space-y-6">
                    <div class="grid grid-cols-1 gap-4">
                        <div class="neu-inset p-4">
                            <label class="text-[10px] font-bold opacity-40 uppercase block mb-1">Admin Title</label>
                            <input type="text" id="admin-title-input" class="bg-transparent w-full outline-none font-semibold">
                        </div>
                        <div class="neu-inset p-4">
                            <label class="text-[10px] font-bold opacity-40 uppercase block mb-1">Support Channel URL</label>
                            <input type="text" id="contact-url" class="bg-transparent w-full outline-none font-semibold text-blue-500">
                        </div>
                        <div class="neu-inset p-4">
                            <label class="text-[10px] font-bold opacity-40 uppercase block mb-1">Global Blocklist (CSV)</label>
                            <textarea id="global-blocklist" class="bg-transparent w-full outline-none font-semibold h-20 resize-none"></textarea>
                        </div>
                    </div>
                    <button onclick="updateGlobalSettings()" class="neu-btn w-full py-4 font-bold text-green-600 flex items-center justify-center gap-2">
                        <i class="fas fa-cloud-upload-alt"></i> Push Changes
                    </button>
                </div>
            </section>

            <!-- App List Section -->
            <div class="flex justify-between items-center mb-6 stagger-card" style="animation-delay: 0.2s">
                <h2 class="text-2xl font-black flex items-center gap-2">
                    <i class="fas fa-apps gradient-icon"></i> Authorized Apps
                </h2>
                <button onclick="addNewApp()" class="neu-btn px-5 py-2 text-blue-500 font-bold text-sm">
                    <i class="fas fa-plus-circle mr-1"></i> ADD NEW
                </button>
            </div>

            <!-- Card Grid -->
            <div id="app-cards-container" class="space-y-8">
                <!-- Cards will be injected here -->
            </div>
        </main>

        <!-- Floating Action Dock -->
        <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-[450px] z-[60]">
            <div class="neu-card p-4 flex justify-between items-center backdrop-blur-2xl bg-opacity-70">
                <button class="w-14 h-14 neu-btn text-blue-500 flex items-center justify-center text-xl"><i class="fas fa-home-alt"></i></button>
                <button onclick="addNewApp()" class="w-16 h-16 bg-gradient-to-tr from-blue-600 to-purple-600 text-white rounded-[24px] shadow-lg shadow-blue-500/40 flex items-center justify-center text-2xl -translate-y-8 border-8 border-[var(--bg)] transition-transform hover:scale-110 active:scale-90">
                    <i class="fas fa-plus"></i>
                </button>
                <button onclick="scrollToTop()" class="w-14 h-14 neu-btn text-gray-500 flex items-center justify-center text-xl"><i class="fas fa-arrow-up"></i></button>
            </div>
        </nav>
    </div>

    <!-- Firebase SDK Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC_DtbizYw47RMwx6QG-CSTPdpEgmIQ7wM",
            authDomain: "sha257-varify-dumodz.firebaseapp.com",
            databaseURL: "https://sha257-varify-dumodz-default-rtdb.firebaseio.com",
            projectId: "sha257-varify-dumodz",
            storageBucket: "sha257-varify-dumodz.firebasestorage.app",
            messagingSenderId: "411803659932",
            appId: "1:411803659932:web:fece07d6b9cd346f330759"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const DB_PATH = "verify-sha256-data-dumodz";

        let currentData = null;

        // Login Handler
        window.login = async () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            try {
                await signInWithEmailAndPassword(auth, email, pass);
                Swal.fire({ icon: 'success', title: 'Welcome Admin', showConfirmButton: false, timer: 1500 });
            } catch (e) { Swal.fire('Error', e.message, 'error'); }
        };

        window.logout = () => {
            Swal.fire({
                title: 'Logout?', text: 'Ending secure session...', icon: 'warning', 
                showCancelButton: true, confirmButtonText: 'Exit'
            }).then(r => { if(r.isConfirmed) signOut(auth).then(() => location.reload()); });
        };

        onAuthStateChanged(auth, user => {
            if (user) {
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('dashboard').classList.remove('hidden');
                loadRealtimeData();
            }
        });

        function loadRealtimeData() {
            onValue(ref(db, DB_PATH), (snap) => {
                const data = snap.val();
                if (data) {
                    currentData = data;
                    renderUI(data);
                }
            });
        }

        function renderUI(data) {
            document.getElementById('admin-label-text').innerText = data.admin_label || "DUModZ";
            document.getElementById('admin-title-input').value = data.admin_label || "";
            document.getElementById('contact-url').value = data.contact_url || "";
            document.getElementById('global-blocklist').value = data.global_blocklist || "";

            const container = document.getElementById('app-cards-container');
            container.innerHTML = '';

            if(data.authorized_apps) {
                data.authorized_apps.forEach((app, idx) => {
                    const card = `
                        <div class="neu-card p-6 stagger-card" style="animation-delay: ${0.1 * idx}s">
                            <div class="flex justify-between items-start mb-5">
                                <div class="w-14 h-14 neu-inset flex items-center justify-center text-2xl text-blue-500">
                                    <i class="fas fa-shield-halved"></i>
                                </div>
                                <div class="flex gap-3">
                                    <button onclick="editApp(${idx})" class="w-10 h-10 neu-btn flex items-center justify-center text-blue-500"><i class="fas fa-pen-nib"></i></button>
                                    <button onclick="deleteApp(${idx})" class="w-10 h-10 neu-btn flex items-center justify-center text-red-500"><i class="fas fa-trash-alt"></i></button>
                                </div>
                            </div>
                            <h3 class="text-xl font-bold mb-1">${app.note}</h3>
                            <p class="text-[11px] opacity-40 font-mono mb-4 tracking-wider uppercase">${app.package_name}</p>
                            
                            <div class="neu-inset p-4 mb-4 relative overflow-hidden group">
                                <span class="text-[9px] font-bold opacity-30 absolute top-2 left-4">SECURITY SHA256</span>
                                <div class="text-[10px] font-mono break-all pt-3 leading-relaxed opacity-80">${app.sha256_key}</div>
                                <button onclick="navigator.clipboard.writeText('${app.sha256_key}')" class="absolute right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity text-blue-500"><i class="fas fa-copy"></i></button>
                            </div>

                            <div class="flex items-center gap-2 p-3 rounded-2xl bg-red-500/5 border border-red-500/10">
                                <i class="fas fa-circle-exclamation text-red-500 text-xs"></i>
                                <span class="text-[10px] font-bold text-red-500/80">BLOCKLIST: ${app.package_blocklist || 'NONE'}</span>
                            </div>
                        </div>
                    `;
                    container.innerHTML += card;
                });
            }
        }

        // Global Update
        window.updateGlobalSettings = () => {
            update(ref(db, DB_PATH), {
                admin_label: document.getElementById('admin-title-input').value,
                contact_url: document.getElementById('contact-url').value,
                global_blocklist: document.getElementById('global-blocklist').value
            }).then(() => Swal.fire('Success', 'Global Database Updated', 'success'));
        };

        // CRUD Helpers
        window.addNewApp = async () => {
            const { value: f } = await Swal.fire({
                title: 'Authorize New App',
                background: getComputedStyle(document.body).getPropertyValue('--card-bg'),
                color: getComputedStyle(document.body).getPropertyValue('--text-main'),
                html: `<div class="space-y-3">
                    <input id="n-note" class="neu-inset w-full p-3 outline-none" placeholder="User/AppName">
                    <input id="n-pkg" class="neu-inset w-full p-3 outline-none" placeholder="Package Name">
                    <input id="n-sha" class="neu-inset w-full p-3 outline-none" placeholder="SHA256 Key">
                    <input id="n-block" class="neu-inset w-full p-3 outline-none" placeholder="Blocklist CSV">
                </div>`,
                preConfirm: () => ({
                    note: document.getElementById('n-note').value,
                    package_name: document.getElementById('n-pkg').value,
                    sha256_key: document.getElementById('n-sha').value,
                    package_blocklist: document.getElementById('n-block').value
                })
            });
            if (f) {
                const apps = currentData.authorized_apps || [];
                apps.push(f);
                update(ref(db, DB_PATH), { authorized_apps: apps });
            }
        };

        window.editApp = async (idx) => {
            const a = currentData.authorized_apps[idx];
            const { value: f } = await Swal.fire({
                title: 'Update App Data',
                background: getComputedStyle(document.body).getPropertyValue('--card-bg'),
                color: getComputedStyle(document.body).getPropertyValue('--text-main'),
                html: `<div class="space-y-3 text-left">
                    <input id="e-note" class="neu-inset w-full p-3 outline-none" value="${a.note}">
                    <input id="e-pkg" class="neu-inset w-full p-3 outline-none" value="${a.package_name}">
                    <input id="e-sha" class="neu-inset w-full p-3 outline-none" value="${a.sha256_key}">
                    <input id="e-block" class="neu-inset w-full p-3 outline-none" value="${a.package_blocklist}">
                </div>`,
                preConfirm: () => ({
                    note: document.getElementById('e-note').value,
                    package_name: document.getElementById('e-pkg').value,
                    sha256_key: document.getElementById('e-sha').value,
                    package_blocklist: document.getElementById('e-block').value
                })
            });
            if (f) {
                const apps = [...currentData.authorized_apps];
                apps[idx] = f;
                update(ref(db, DB_PATH), { authorized_apps: apps });
            }
        };

        window.deleteApp = (idx) => {
            Swal.fire({
                title: 'Confirm Delete?', text: 'This action is permanent!', icon: 'error',
                showCancelButton: true, confirmButtonColor: '#ef4444'
            }).then(r => {
                if(r.isConfirmed) {
                    const apps = currentData.authorized_apps.filter((_, i) => i !== idx);
                    update(ref(db, DB_PATH), { authorized_apps: apps });
                }
            });
        };

        // Theme Toggle
        window.toggleTheme = () => {
            const b = document.body;
            b.classList.toggle('dark-mode');
            const icon = document.getElementById('theme-icon');
            icon.classList.toggle('fa-moon');
            icon.classList.toggle('fa-sun');
        };

        window.scrollToTop = () => window.scrollTo({ top: 0, behavior: 'smooth' });

    </script>
</body>
</html>
